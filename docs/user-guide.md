# 초고정밀 멀티랭귀지 OCR 시스템 사용자 가이드

## 목차

1. [소개](#소개)
2. [시스템 개요](#시스템-개요)
3. [시작하기](#시작하기)
   - [설치 방법](#설치-방법)
   - [로그인](#로그인)
4. [기본 사용법](#기본-사용법)
   - [문서 업로드](#문서-업로드)
   - [OCR 처리 결과 확인](#ocr-처리-결과-확인)
   - [데이터 추출](#데이터-추출)
   - [내보내기](#내보내기)
5. [고급 기능](#고급-기능)
   - [특수 항목 감지](#특수-항목-감지)
   - [다국어 지원](#다국어-지원)
   - [앙상블 OCR 시스템](#앙상블-ocr-시스템)
6. [시스템 설정](#시스템-설정)
   - [추출 필드 구성](#추출-필드-구성)
   - [OCR 엔진 설정](#ocr-엔진-설정)
   - [처리 옵션](#처리-옵션)
7. [API 사용법](#api-사용법)
8. [문제 해결](#문제-해결)
9. [자주 묻는 질문](#자주-묻는-질문)

## 소개

초고정밀 멀티랭귀지 OCR 시스템은 일본 비즈니스 문서를 위한 고성능 OCR(Optical Character Recognition) 솔루션입니다. 다양한 OCR 엔진을 앙상블하여 99.5% 이상의 정확도를 제공하며, 특히 일본어, 한국어, 영어, 중국어 문서 처리에 최적화되어 있습니다.

### 주요 기능

- **다국어 지원**: 일본어, 한국어, 영어, 중국어(간체/번체) 지원
- **PDF 자동 방향 보정**: 기울어지거나 회전된 페이지 자동 감지 및 보정
- **고정확도 OCR**: 여러 OCR 엔진 앙상블로 최고 수준의 정확도 제공
- **특수 항목 인식**: 도장, 손글씨, 수정된 텍스트 등 인식
- **LLM 기반 데이터 추출**: 설정 가능한 필드 자동 추출
- **CSV 내보내기**: 추출된 데이터를 CSV로 저장
- **웹 인터페이스**: 직관적인 웹 UI로 문서 관리 및 추출 결과 검토

## 시스템 개요

초고정밀 OCR 시스템은 다음과 같은 주요 모듈로 구성되어 있습니다:

1. **문서 처리 모듈**: PDF 파일을 이미지로 변환하고 방향 보정을 수행합니다.
2. **OCR 앙상블 모듈**: 여러 OCR 엔진의 결과를 조합하여 최상의 텍스트 인식 결과를 제공합니다.
3. **특수 항목 감지 모듈**: 도장, 손글씨, 취소선 등 특수 요소를 감지합니다.
4. **데이터 추출 모듈**: LLM(Language Model)을 활용하여 구조화된 데이터를 추출합니다.
5. **웹 인터페이스**: 직관적인 사용자 인터페이스로 전체 프로세스를 관리합니다.

## 시작하기

### 설치 방법

#### Docker를 이용한 간편 설치 (권장)

```bash
# 1. 저장소 복제
git clone https://github.com/yourusername/precision-ocr-system.git
cd precision-ocr-system

# 2. 환경 변수 설정
cp .env.example .env
# .env 파일을 편집하여 API 키 등 설정

# 3. Docker로 실행
docker-compose up -d

# 4. 웹 접속 (브라우저에서)
# http://localhost:8000
```

#### 수동 설치

자세한 수동 설치 방법은 README.md의 '수동 설치' 섹션을 참조하세요.

### 로그인

1. 웹 브라우저에서 `http://localhost:8000` 또는 시스템이 설치된 서버 주소에 접속합니다.
2. 기본 계정으로 로그인합니다:
   - 사용자명: `admin`
   - 비밀번호: `admin`
3. 보안을 위해 최초 로그인 후 비밀번호를 변경하는 것을 권장합니다.

## 기본 사용법

### 문서 업로드

1. 웹 인터페이스의 주 화면에서 **문서 업로드** 버튼을 클릭하거나, 상단 메뉴에서 **업로드**를 선택합니다.

2. 문서 업로드 화면에서:
   - 파일 드롭 영역을 클릭하거나 파일을 끌어다 놓아 업로드합니다.
   - 지원 파일 형식: PDF, JPG, JPEG, PNG, TIFF, BMP, GIF
   - 최대 파일 크기: 20MB

3. 언어 설정:
   - **언어 선택** 드롭다운에서 문서 언어를 선택합니다.
   - 자동 감지를 사용하려면 비워두세요.

4. 추가 옵션:
   - **엔티티 추출** 체크박스를 통해 회사명, 날짜, 금액 등 자동 추출 여부를 설정합니다.

5. **업로드 및 처리** 버튼을 클릭하여 OCR 처리를 시작합니다.

6. 처리가 완료될 때까지 대기합니다. 문서 크기와 복잡도에 따라 몇 초에서 몇 분이 소요될 수 있습니다.

### OCR 처리 결과 확인

OCR 처리가 완료되면 결과 페이지로 자동 이동합니다. 결과 페이지에서는 다음과 같은 정보를 확인할 수 있습니다:

1. **전체 텍스트 탭**:
   - 문서 전체에서 추출된 텍스트를 확인할 수 있습니다.
   - **복사** 버튼을 클릭하여 텍스트를 클립보드에 복사할 수 있습니다.

2. **페이지별 보기 탭**:
   - 멀티페이지 문서의 경우 각 페이지별 텍스트를 확인할 수 있습니다.
   - 각 페이지의 OCR 신뢰도와 방향 보정 정보가 표시됩니다.
   - 특수 항목(도장, 손글씨 등) 검출 정보가 표시됩니다.

3. **엔티티 탭**:
   - 자동으로 추출된 엔티티(회사명, 날짜, 금액 등)를 확인할 수 있습니다.

### 데이터 추출

OCR 결과에서 구조화된 데이터를 추출하려면:

1. OCR 결과 페이지에서 **데이터 추출** 버튼을 클릭합니다.

2. 데이터 추출 페이지에서 시스템이 자동으로 정의된 필드에 대한 데이터를 추출합니다.
   - 기본 필드: 청구서 번호, 날짜, 총액, 회사명, 세금 등
   - 각 필드의
    신뢰도를 확인할 수 있습니다.

3. 필요한 경우 추출된 값을 수정하거나 새 필드를 추가할 수 있습니다.

4. **저장** 버튼을 클릭하여 추출 결과를 저장합니다.

### 내보내기

추출된 데이터를 CSV 형식으로 내보내려면:

1. 데이터 추출 결과 페이지에서 **CSV 내보내기** 버튼을 클릭합니다.

2. 브라우저에서 CSV 파일이 자동으로 다운로드됩니다.

3. 이 CSV 파일은 Excel 또는 기타 데이터 처리 소프트웨어에서 열 수 있습니다.

## 고급 기능

### 특수 항목 감지

본 시스템은 다음과 같은 특수 항목을 자동으로 감지합니다:

1. **도장 감지**:
   - 일본 비즈니스 문서에서 자주 사용되는 도장(한자 도장, 회사 직인 등)을 감지합니다.
   - 빨간색 도장과 일반 도장 모두 감지됩니다.

2. **손글씨 감지**:
   - 문서 내 손글씨 영역을 식별합니다.
   - 손글씨 영역은 OCR 결과에서 별도로 표시됩니다.

3. **취소선 감지**:
   - 취소선이 그어진 텍스트를 감지합니다.
   - 수정된 항목 추적에 유용합니다.

4. **표 구조 감지**:
   - 문서 내 표 구조를 감지하고 분석합니다.
   - 표 데이터를 구조화된 형식으로 추출합니다.

### 다국어 지원

본 시스템은 다음 언어를 공식적으로 지원합니다:

- **일본어(jpn)**: 최적화된 일본어 인식을 제공합니다.
- **한국어(kor)**: 한글 및 한자를 정확하게 인식합니다.
- **영어(eng)**: 영문 텍스트에 대한 고정밀 인식을 제공합니다.
- **중국어 간체(chi_sim)**: 중국 본토에서 사용되는 간체자를 지원합니다.
- **중국어 번체(chi_tra)**: 대만 및 홍콩에서 사용되는 번체자를 지원합니다.

언어는 자동으로 감지되지만, 문서 업로드 시 명시적으로 지정할 수도 있습니다.

### 앙상블 OCR 시스템

본 시스템은 여러 OCR 엔진의 결과를 조합하여 정확도를 극대화합니다:

1. **TrOCR 모델**: 딥러닝 기반 OCR 모델로 일본어 문서에 최적화되어 있습니다.
2. **Tesseract OCR**: 오픈소스 OCR 엔진으로 다양한 언어를 지원합니다.
3. **Google Cloud Vision**: Google의 클라우드 OCR API로 높은 정확도를 제공합니다.
4. **Azure Form Recognizer**: Microsoft의 양식 인식 API로 구조화된 문서 처리에 최적화되어 있습니다.

각 엔진의 결과를 신뢰도에 따라 가중치를 부여하여 최상의 결과를 도출합니다.

## 시스템 설정

### 추출 필드 구성

추출할 필드를 설정하려면:

1. 상단 메뉴에서 **설정**을 클릭합니다.

2. **추출 필드 설정** 탭에서 JSON 형식으로 필드를 정의할 수 있습니다:
   ```json
   [
     {
       "name": "invoice_number",
       "type": "text",
       "context": "청구서 번호|請求書番号|インボイス番号|No.|番号",
       "regex": "(\\d{1,3}[\\-\\.]\\d{1,3}[\\-\\.]\\d{1,5})"
     },
     {
       "name": "date",
       "type": "date",
       "context": "날짜|発行日|日付|date",
       "regex": "(\\d{4}[-/年\\.]{1,2}\\d{1,2}[-/月\\.]{1,2}\\d{1,2}[日]?)"
     }
   ]
   ```

3. 각 필드 정의는 다음 속성을 포함합니다:
   - **name**: 필드 이름 (고유 식별자)
   - **type**: 필드 유형 (text, date, amount, company, person, address, phone, email, number)
   - **context**: 필드 주변에 나타나는 키워드 (여러 개인 경우 | 로 구분)
   - **regex**: 필드 값에 대한 정규식 패턴 (선택적)

4. **설정 저장** 버튼을 클릭하여 변경사항을 적용합니다.

### OCR 엔진 설정

OCR 엔진 설정을 조정하려면:

1. 상단 메뉴에서 **설정**을 클릭합니다.

2. **OCR 엔진 설정** 탭에서 각 엔진의 활성화 여부와 가중치를 조정할 수 있습니다:
   - **커스텀 모델 (TrOCR)**: 딥러닝 기반 OCR 모델
   - **Tesseract OCR**: 오픈소스 OCR 엔진
   - **Google Cloud Vision**: Google의 클라우드 OCR API
   - **Azure Form Recognizer**: Microsoft의 양식 인식 API

3. **신뢰도 임계값**을 조정하여 OCR 결과의 품질을 제어할 수 있습니다.
   - 낮은 값: 더 많은 텍스트 인식, 오류 가능성 증가
   - 높은 값: 정확도 향상, 인식되는 텍스트 양 감소

4. **설정 저장** 버튼을 클릭하여 변경사항을 적용합니다.

### 처리 옵션

추가 처리 옵션을 구성하려면:

1. 상단 메뉴에서 **설정**을 클릭합니다.

2. **처리 옵션** 탭에서 다음 설정을 조정할 수 있습니다:
   - **도장 감지**: 문서 내 도장 자동 감지 활성화
   - **손글씨 감지**: 손글씨 영역 자동 감지 활성화
   - **취소선 감지**: 취소선이 그어진 텍스트 감지 활성화

3. **언어 설정**에서 지원할 언어를 선택할 수 있습니다.

4. **설정 저장** 버튼을 클릭하여 변경사항을 적용합니다.

## API 사용법

본 시스템은 RESTful API를 통해 프로그래밍 방식으로 사용할 수 있습니다:

### 문서 OCR 처리 요청

```bash
# 문서 OCR 처리 요청
curl -X POST \
  -F "file=@your_document.pdf" \
  -F "options={\"language\":\"jpn\", \"extract_entities\":true}" \
  http://localhost:8000/api/v1/ocr
```

### 처리 결과 확인

```bash
# 처리 결과 확인
curl http://localhost:8000/api/v1/ocr/{task_id}
```

### 추출 필드 설정 가져오기

```bash
# 추출 필드 설정 가져오기
curl http://localhost:8000/api/v1/extraction/fields
```

### CSV 내보내기

```bash
# CSV 내보내기
curl -X GET \
  -o extracted_data.csv \
  http://localhost:8000/api/v1/extraction/{task_id}/csv
```

API에 대한 자세한 정보는 `/api/docs` 엔드포인트에서 Swagger UI를 통해 확인할 수 있습니다.

## 문제 해결

### 자주 발생하는 문제

#### 설치 문제

- **Tesseract 오류**: 
  - 해결: `apt-get install tesseract-ocr` 명령으로 재설치
  - 또는 Docker 설치 방법 사용

- **MeCab 사전 오류**:
  - 해결: `mecab-ipadic-neologd` 사전 수동 설치 확인
  ```bash
  git clone --depth 1 https://github.com/neologd/mecab-ipadic-neologd.git
  cd mecab-ipadic-neologd
  ./bin/install-mecab-ipadic-neologd -n -y
  ```

- **Redis 연결 오류**:
  - 해결: Redis 서버 실행 중인지 확인 (`redis-cli ping`)
  - Docker Compose를 사용하는 경우 redis 서비스가 실행 중인지 확인

#### 성능 문제

- **메모리 부족**:
  - 해결: `docker-compose.yml`에서 메모리 제한 증가
  ```yaml
  services:
    web:
      mem_limit: 4g
    worker:
      mem_limit: 8g
  ```

- **느린 처리 속도**:
  - 해결: GPU 지원 활성화 또는 배치 크기 조정
  - `.env` 파일에서 `OCR_BATCH_SIZE=4` 값 조정

- **낮은 OCR 정확도**:
  - 해결: 특정 문서 유형에 맞게 앙상블 가중치 조정
  - 설정 페이지에서 엔진별 가중치 조정

#### 일반적인 오류

- **파일 형식 오류**:
  - 해결: 지원되는 파일 형식(PDF, JPG, PNG) 사용

- **API 키 오류**:
  - 해결: `.env` 파일에서 Google/Azure API 키 확인

- **언어 감지 실패**:
  - 해결: 수동으로 언어 지정 (`language` 옵션 사용)

## 자주 묻는 질문

### 일반 질문

**Q: 지원되는 최대 파일 크기는 얼마인가요?**

A: 기본 설정에서는 20MB까지 지원합니다. 이 제한은 `.env` 파일의 `OCR_UPLOAD_MAX_SIZE` 값을 수정하여 변경할 수 있습니다.

**Q: PDF 문서의 최대 페이지 수 제한이 있나요?**

A: 기본적으로 PDF 문서는 최대 100페이지까지 처리할 수 있습니다. 이 제한은 `.env` 파일의 `OCR_MAX_PDF_PAGES` 값을 조정하여 변경할 수 있습니다.

**Q: 지원하는 언어를 추가할 수 있나요?**

A: 현재 시스템은 일본어, 한국어, 영어, 중국어(간체/번체)를 기본적으로 지원합니다. 추가 언어 지원을 위해서는 관련 OCR 엔진과 모델을 구성해야 합니다.

### 기술 질문

**Q: OCR 정확도를 높이려면 어떻게 해야 하나요?**

A: 다음 방법으로 정확도를 향상시킬 수 있습니다:
- 올바른 언어 설정 지정
- 이미지 품질 개선 (해상도, 대비)
- 엔진별 가중치 조정
- 특정 문서 유형에 최적화된 설정 사용

**Q: 시스템을 더 많은 문서를 처리하도록 확장할 수 있나요?**

A: 예, 다음과 같은 방법으로 확장할 수 있습니다:
- Docker Swarm 또는 Kubernetes를 사용하여 여러 작업자 노드 배포
- `.env` 파일에서 `OCR_MAX_WORKERS` 값 증가
- 대규모 배치 처리를 위한 분산 처리 구성

**Q: 데이터 추출 정확도를 개선하려면 어떻게 해야 하나요?**

A: 데이터 추출 정확도를 높이려면:
- 추출 필드 정의에 정확한 컨텍스트 키워드 추가
- 정규식 패턴 사용하여 값 형식 지정
- LLM 설정 최적화 (설정 파일 및 API 키 구성)

**Q: 문서 처리 결과는 얼마나 오래 보관되나요?**

A: 기본적으로 처리 결과는 시스템 내에 영구적으로 저장됩니다. 데이터 정책에 따라 자동 삭제 일정을 구성할 수 있습니다.

### 비즈니스 질문

**Q: 이 시스템을 클라우드에 배포할 수 있나요?**

A: 예, Docker 이미지를 사용하여 AWS, Google Cloud, Azure 등의 클라우드 서비스에 쉽게 배포할 수 있습니다.

**Q: 기업 내부 시스템과 통합할 수 있나요?**

A: 예, RESTful API를 통해 다양한 기업 내부 시스템(ERP, 회계 소프트웨어 등)과 통합할 수 있습니다.

**Q: 이 시스템의 소스 코드를 수정하여 사용할 수 있나요?**

A: 예, MIT 라이선스에 따라 자유롭게 수정하고 사용할 수 있습니다. 단, 라이선스 요구사항을 준수해야 합니다.
